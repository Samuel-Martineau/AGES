// smart infinite scroll with onMount and onDestroy event handlers

<script lang="ts">
	import { onMount, onDestroy } from 'svelte';
	let listElement: any;

	let items: string[] = [];

	for (let index = 0; index < 20; index++) {
		items = [...items, `item ${index}`];
	}

	// Add 20 items.
	function loadMore() {
		for (var index = 0; index < 20; index++) {
			items = [...items, `item ${items.length}`];
		}
	}

	onMount(() => {
		if (listElement) {
			console.log('listElm is defined');
			listElement.addEventListener('scroll', function () {
				if (listElement.scrollTop + listElement.clientHeight >= listElement.scrollHeight) {
					loadMore();
				}
			});
		}
	});

	onDestroy(() => {
		listElement.removeEventListener('scroll', () => {});
	});
</script>

<ul bind:this={listElement}>
	{#each items as item}
		<li>{item}</li>
	{/each}
</ul>

<!-- markup (zero or more items) goes here -->
<style>
	ul {
		/* We need to limit the height and show a scrollbar */
		width: 200px;
		height: 300px;
		overflow: auto;

		/* Optional, only to check that it works with margin/padding */
		margin: 30px;
		padding: 20px;
		border: 10px solid black;
	}

	/* Optional eye candy below: */
	li {
		padding: 10px;
		list-style-type: none;
	}
	li:hover {
		background: #ccc;
	}
</style>
